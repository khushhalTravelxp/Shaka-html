<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shaka Player - HLS DRM</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.5.2/shaka-player.compiled.min.js"></script>
  </head>
  <body>
    <video id="video" width="70%" height="700px" controls autoplay></video>
    <p><strong>Codec Info:</strong> <span id="codec-info">Loading...</span></p>
    <script>
      async function initPlayer() {
        if (!shaka.Player.isBrowserSupported()) {
          console.error("Shaka Player is not supported on this browser.");
          return;
        }

        shaka.polyfill.installAll();
        const video = document.getElementById("video");
        const player = new shaka.Player(video);

        player.configure({
          drm: {
            servers: {
              "com.apple.fps": "https://c8eaeae1-drm-fairplay-licensing.axprod.net/AcquireLicense"
            },
            advanced: {
              "com.apple.fps": {
                serverCertificateUri: "https://travelxp.akamaized.net/cert/fairplay/fairplay.cer"
              }
            }
          },
          streaming: {
            useNativeHlsForFairPlay: true,
            bufferingGoal: 20,
            rebufferingGoal: 4,
            bufferBehind: 20,
            lowLatencyMode: false
          },
          manifest: {
            hls: {
              useFullSegmentsForStartTime: true
            }
          }
        });

        player.getNetworkingEngine().registerRequestFilter((type, request) => {
          if (type === shaka.net.NetworkingEngine.RequestType.LICENSE) {
            request.headers["X-AxDRM-Message"] =
              "eyJhbGciOiJIUzI1NiJ9.eyJ2ZXJzaW9uIjoxLCJjb21fa2V5X2lkIjoiYjQ1ODc2N2QtYTgzYi00MWQ0LWFlNjgtYWNhNzAwZDNkODRmIiwibWVzc2FnZSI6eyJ0eXBlIjoiZW50aXRsZW1lbnRfbWVzc2FnZSIsInZlcnNpb24iOjIsImxpY2Vuc2UiOnsiZXhwaXJhdGlvbl9kYXRldGltZSI6IjIwMjUtMDItMTlUMDU6MzY6NTUuMTAzWiIsImFsbG93X3BlcnNpc3RlbmNlIjp0cnVlLCJyZWFsX3RpbWVfZXhwaXJhdGlvbiI6dHJ1ZX0sImNvbnRlbnRfa2V5X3VzYWdlX3BvbGljaWVzIjpbeyJuYW1lIjoiUG9saWN5IEEiLCJ3aWRldmluZSI6eyJkZXZpY2Vfc2VjdXJpdHlfbGV2ZWwiOiJTV19TRUNVUkVfQ1JZUFRPIn19XSwiY29udGVudF9rZXlzX3NvdXJjZSI6eyJpbmxpbmUiOlt7ImlkIjoiMTAyM2JhMThiZTMzYWE4YTg2MTFlZWE4OGNkZWQ5ZTMiLCJ1c2FnZV9wb2xpY3kiOiJQb2xpY3kgQSJ9LHsiaWQiOiJjY2I0ZjJmYjExNTVmN2JmYmIwN2U3Yzc1ZDI2YTY3YSIsInVzYWdlX3BvbGljeSI6IlBvbGljeSBBIn0seyJpZCI6IjU4ODE5M2VjZjhjMzc5OGY2MjMxYjM1N2M0N2YwYWJiIiwidXNhZ2VfcG9saWN5IjoiUG9saWN5IEEifV19fSwiaWF0IjoxNzM5ODYwNjE1LCJleHAiOjE3Mzk5NDcwMTV9.R0nUhAfu7aQqLoufBOjhLosKOUadarN_cpLzf5kMNH8";
          }
        });

        try {
          await player.load("https://travelxp.akamaized.net/60a66806d659ded70c8f1eb6/manifest_v1_hd_28042023_1353_only_h264.m3u8");
          console.log("The video has been loaded successfully!");

          const tracks = player.getVariantTracks();
          if (tracks.length > 0) {
            const codecs = tracks.map((track) => track.videoCodec + ", " + track.audioCodec).join(" | ");
            console.log("Codec Information:", codecs);
            document.getElementById("codec-info").textContent = codecs;
          } else {
            console.warn("No tracks found!");
          }
        } catch (error) {
          console.error("Error loading video", error);
        }
      }

      document.addEventListener("DOMContentLoaded", initPlayer);
    </script>
  </body>
</html>
